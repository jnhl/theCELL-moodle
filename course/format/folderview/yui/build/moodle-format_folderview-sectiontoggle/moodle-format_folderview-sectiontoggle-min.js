YUI.add("moodle-format_folderview-sectiontoggle",function(e,t){function r(){r.superclass.constructor.apply(this,arguments)}var n={MAINWRAPPER:".course-content ul.folderview",ALLSECTIONS:".course-content ul.folderview li.section",SECTION:"li.section",SECTIONNAMELINK:".sectionname a",TOGGLETARGET:".left.side .foldertoggle",EXPANDALL:"#topiclinktop .expand-sections",COLLAPSEALL:"#topiclinktop .collapse-sections"};r.NAME=t,r.ATTRS={courseid:{validator:e.Lang.isNumber},ajaxurl:{validator:e.Lang.isString},expandedsections:{value:[],validator:e.Lang.isArray},liveLog:{readOnly:!0,valueFn:function(){return M.local_mr.init_livelog({})}}},e.extend(r,e.Base,{initializer:function(){var t=e.all(n.ALLSECTIONS);this.init_section_attributes(t);var r=e.one(n.MAINWRAPPER);r&&r.delegate("click",this.handle_section_toggle,n.TOGGLETARGET+", "+n.SECTIONNAMELINK,this);var i=e.one(n.EXPANDALL);i&&i.on("click",this.handle_expand_all,this);var s=e.one(n.COLLAPSEALL);s&&s.on("click",this.handle_collapse_all,this),t.isEmpty()||t.on("drop",this.handle_drop,this)},init_section_attributes:function(t){if(t.isEmpty())return;t.each(function(t){e.Array.indexOf(this.get("expandedsections"),this.get_section_number(t))!==-1?this.expand_section(t):this.collapse_section(t)},this)},ignore_section:function(e){return!e||e.hasClass("orphaned")||this.get_section_number(e)===0},toggle_section:function(e){if(this.ignore_section(e))return;e.hasClass("expanded")?this.collapse_section(e):this.expand_section(e)},collapse_section:function(e){if(this.ignore_section(e))return;e.removeClass("expanded"),this.update_section_labels(e,"before-aria-label")},expand_section:function(e){if(this.ignore_section(e))return;e.addClass("expanded"),this.update_section_labels(e,"after-aria-label")},update_section_labels:function(t,r){var i=t.one(n.TOGGLETARGET),s=t.one(n.SECTIONNAMELINK);if(!i)return;var o=[i];s&&o.push(s);var u=new e.NodeList(o);u.setAttribute("aria-label",i.getData(r)).setAttribute("title",i.getData(r))},handle_section_toggle:function(e){e.preventDefault();var t=e.target.ancestor(n.SECTION);if(this.ignore_section(t))return;this.toggle_section(t),t.hasClass("expanded")?this.get("liveLog").log_text(M.str.format_folderview.topicexpanded):this.get("liveLog").log_text(M.str.format_folderview.topiccollapsed),this.save_expanded_sections()},handle_expand_all:function(t){t.preventDefault(),e.all(n.ALLSECTIONS).each(function(e){this.expand_section(e)},this),this.get("liveLog").log_text(M.str.format_folderview.alltopicsexpanded),this.save_expanded_sections()},handle_collapse_all:function(t){t.preventDefault(),e.all(n.ALLSECTIONS).each(function(e){this.collapse_section(e)},this),this.get("liveLog").log_text(M.str.format_folderview.alltopicscollapsed),this.save_expanded_sections()},handle_drop:function(e){var t=e.currentTarget;t.test(n.SECTION)||(t=t.ancestor(n.SECTION)),t&&!t.hasClass("expanded")&&(this.expand_section(t),this.save_expanded_sections())},save_expanded_sections:function(){var t=[];e.all("li.section.expanded").each(function(e){t.push(this.get_section_number(e))},this),e.io(this.get("ajaxurl"),{context:this,method:"POST",data:{courseid:this.get("courseid"),expandedsections:t.join(","),action:"setexpandedsections",sesskey:M.cfg.sesskey},on:{complete:function(e,t){},failure:function(e,t){}}})},get_section_number:function(e){return Number(e.get("id").replace(/section-/i,""))}}),M.format_folderview=M.format_folderview||{},M.format_folderview.SectionToggle=r,M.format_folderview.init_sectiontoggle=function(e){return new r(e)}},"@VERSION@",{requires:["base","event","io","moodle-local_mr-livelog"]});
